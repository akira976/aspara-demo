<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è¾²æ¥­ç”¨å¤–è¦³ãƒã‚§ãƒƒã‚¯ï¼ˆè©¦ä½œï¼‰</title>
<style>
body{font-family:system-ui;margin:0;background:#fff;color:#111}
header{padding:12px;border-bottom:1px solid #eee}
main{padding:12px;max-width:800px;margin:auto}
button{padding:10px 14px;border-radius:8px;border:1px solid #ccc;background:#fff;font-weight:bold}
.card{border:1px solid #eee;border-radius:12px;padding:12px;margin-bottom:12px}
canvas{width:100%;border-radius:12px;border:1px solid #ddd}
.pill{display:inline-block;padding:6px 12px;border-radius:20px;font-weight:bold}
.ok{background:#e6f7ec;color:#0a7a2f}
.warn{background:#fff4e5;color:#b36b00}
.bad{background:#fdecea;color:#b00020}
small{color:#666}
</style>
</head>
<body>

<header>
<h2>è¾²æ¥­ç”¨å¤–è¦³ãƒã‚§ãƒƒã‚¯ï¼ˆè©¦ä½œï¼‰</h2>
<small>æ–­å®šã—ã¾ã›ã‚“ã€‚è¦è¦³å¯Ÿã‚’å‡ºã™è£œåŠ©ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</small>
</header>

<main>

<div class="card">
<div id="result" class="pill warn">è¦è¦³å¯Ÿ</div>
<p>ã‚¹ã‚³ã‚¢: <span id="score">--</span></p>
</div>

<div class="card">
<button onclick="openCamera()">ğŸ“· æ’®å½±</button>
<input type="file" id="file" accept="image/*">
<button onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div class="card">
<canvas id="canvas"></canvas>
</div>

</main>

<script>
let canvas=document.getElementById("canvas");
let ctx=canvas.getContext("2d");
let img=new Image();
let currentScore=null;

function resetAll(){
ctx.clearRect(0,0,canvas.width,canvas.height);
document.getElementById("score").textContent="--";
document.getElementById("result").textContent="è¦è¦³å¯Ÿ";
document.getElementById("result").className="pill warn";
}

document.getElementById("file").addEventListener("change",function(e){
let file=e.target.files[0];
let reader=new FileReader();
reader.onload=function(evt){
img.onload=function(){
canvas.width=img.width;
canvas.height=img.height;
ctx.drawImage(img,0,0);
analyze();
};
img.src=evt.target.result;
};
reader.readAsDataURL(file);
});

function openCamera(){
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(stream=>{
let video=document.createElement("video");
video.srcObject=stream;
video.play();
video.onloadedmetadata=function(){
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
ctx.drawImage(video,0,0);
stream.getTracks().forEach(t=>t.stop());
analyze();
};
})
.catch(()=>{
alert("ã‚«ãƒ¡ãƒ©ãŒä½¿ãˆã¾ã›ã‚“ã€‚Chromeã¾ãŸã¯Safariã§é–‹ã„ã¦ãã ã•ã„ã€‚");
});
}

function analyze(){
let data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
let sum=0;
for(let i=0;i<data.length;i+=4){
sum+=data[i]+data[i+1]+data[i+2];
}
let avg=sum/(data.length/4*3);
currentScore=Math.abs(128-avg);
document.getElementById("score").textContent=Math.round(currentScore);

let result=document.getElementById("result");
if(currentScore<20){
result.textContent="å¥å…¨å‚¾å‘";
result.className="pill ok";
}else if(currentScore<50){
result.textContent="è¦è¦³å¯Ÿ";
result.className="pill warn";
}else{
result.textContent="ç•°å¸¸ç–‘ã„";
result.className="pill bad";
}
}
</script>

</body>
</html>
